# 自动部署指南

## 概述

`axi-project-dashboard` 项目现在支持完全自动化的部署，无需手动运行任何脚本。所有问题都会在启动过程中自动检测和修复。

## 一键部署

### 方法一：使用启动脚本（推荐）

```bash
# 进入项目目录
cd axi-project-dashboard

# 一键启动（自动修复所有问题）
bash start.sh
```

### 方法二：使用 npm 脚本

```bash
# 进入项目目录
cd axi-project-dashboard

# 使用 npm 启动
npm run start
```

## 自动化修复功能

启动脚本会自动处理以下问题：

### 1. 依赖问题
- ✅ 自动安装缺失的依赖
- ✅ 修复 side-channel 依赖冲突
- ✅ 强制重新安装依赖包

### 2. 目录结构问题
- ✅ 自动创建 `src` 目录（如果不存在）
- ✅ 自动移动 TypeScript 文件到正确位置
- ✅ 创建必要的子目录结构

### 3. 模块别名问题
- ✅ 自动重新构建项目
- ✅ 自动添加 `module-alias/register` 引用
- ✅ 验证路径别名转换
- ✅ 自动修复构建错误

### 4. PM2 配置问题
- ✅ 自动停止和删除旧服务
- ✅ 使用正确的启动脚本路径
- ✅ 自动重启服务

### 5. 服务验证
- ✅ 等待服务启动
- ✅ 验证端口监听
- ✅ 检查服务状态
- ✅ 显示服务日志

## 部署流程

启动脚本会按以下顺序执行：

1. **环境检查**
   - 检查 Node.js 环境
   - 检查 PM2 安装
   - 显示目录结构

2. **自动修复**
   - 修复依赖问题
   - 修复模块别名问题
   - 重新构建项目

3. **服务启动**
   - 停止旧服务
   - 启动新服务
   - 等待服务就绪

4. **健康检查**
   - 验证端口监听
   - 检查服务状态
   - 显示最终状态

## 故障排除

### 如果启动失败

1. **检查日志**：
   ```bash
   pm2 logs dashboard-backend
   ```

2. **检查服务状态**：
   ```bash
   pm2 status
   ```

3. **手动重启**：
   ```bash
   pm2 restart dashboard-backend
   ```

### 常见问题

1. **端口被占用**：
   - 脚本会自动停止旧服务
   - 如果仍有问题，手动检查端口占用

2. **权限问题**：
   - 确保有足够的文件系统权限
   - 确保可以安装 npm 包

3. **网络问题**：
   - 检查网络连接
   - 检查防火墙设置

## 验证部署

部署成功后，您应该看到：

```
🎉 Startup process completed successfully!
✅ Service should be running now
📊 Final service status:
┌────┬──────────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name                 │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼──────────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0  │ dashboard-backend    │ default     │ 1.0.0   │ fork    │ 12345    │ 30s    │ 0    │ online    │ 0%       │ 50.0mb   │ root     │ disabled │
└────┴──────────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
```

## 服务访问

- **API 服务**：http://localhost:8080/api
- **健康检查**：http://localhost:8080/health
- **API 文档**：http://localhost:8080/api-docs

## 注意事项

1. **首次部署**：可能需要较长时间，因为需要下载依赖和编译代码
2. **后续部署**：会更快，因为会复用已安装的依赖
3. **自动重启**：如果服务崩溃，PM2 会自动重启
4. **日志管理**：日志文件保存在 `/var/log/axi-deploy-dashboard/`

## 总结

现在您只需要运行 `bash start.sh` 就可以完成所有部署工作，无需手动干预。脚本会自动处理所有已知问题，确保服务正常启动和运行。
