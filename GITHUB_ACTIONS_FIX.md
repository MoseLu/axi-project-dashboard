# GitHub Actions éƒ¨ç½²ä¿®å¤æŒ‡å—

## ğŸ” é—®é¢˜åˆ†æ

`axi-project-dashboard` é¡¹ç›®é€šè¿‡ GitHub Actions è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œé”™è¯¯ `Cannot find module 'depd'` æ˜¯ç”±ä»¥ä¸‹é—®é¢˜å¯¼è‡´çš„ï¼š

### æ ¹æœ¬åŸå› 
1. **TypeScriptç¼–è¯‘é…ç½®é—®é¢˜**ï¼šæ¨¡å—è·¯å¾„åˆ«å(@/)åœ¨ç¼–è¯‘åæ²¡æœ‰æ­£ç¡®è§£æ
2. **æ„å»ºäº§ç‰©è·¯å¾„é”™è¯¯**ï¼šPM2é…ç½®æŒ‡å‘äº†é”™è¯¯çš„æ–‡ä»¶è·¯å¾„
3. **ä¾èµ–éªŒè¯ä¸è¶³**ï¼šæ„å»ºè¿‡ç¨‹ä¸­æ²¡æœ‰å……åˆ†éªŒè¯å…³é”®ä¾èµ–çš„å­˜åœ¨

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤çš„æ–‡ä»¶

#### `backend/tsconfig.json`
```json
{
  "compilerOptions": {
    "outDir": "./dist",  // ç¡®ä¿è¾“å‡ºåˆ°distç›®å½•
    // ... å…¶ä»–é…ç½®ä¿æŒä¸å˜
  }
}
```

#### `ecosystem.config.js`
```javascript
{
  script: './backend/index.js',  // æŒ‡å‘æ­£ç¡®çš„ç¼–è¯‘è¾“å‡ºæ–‡ä»¶
  // ... å…¶ä»–é…ç½®ä¿æŒä¸å˜
}
```

#### `.github/workflows/axi-project-dashboard_deploy.yml`
**ä¸»è¦ä¿®æ”¹**ï¼š
- **æ„å»ºåç«¯æ­¥éª¤**ï¼šå¢åŠ ä¾èµ–éªŒè¯ï¼Œä½¿ç”¨`npx tsc`ç›´æ¥ç¼–è¯‘
- **éƒ¨ç½²æ–‡ä»¶å‡†å¤‡**ï¼šéªŒè¯æ„å»ºäº§ç‰©çš„å®Œæ•´æ€§
- **éƒ¨ç½²è„šæœ¬**ï¼šç§»é™¤å¤æ‚çš„è·¯å¾„åˆ«ååŒ…è£…å™¨ï¼Œç®€åŒ–éªŒè¯æµç¨‹

### 2. å…³é”®ä¿®å¤ç‚¹

#### ğŸ”¨ **æ„å»ºè¿‡ç¨‹æ”¹è¿›**
```yaml
- name: æ„å»ºåç«¯
  working-directory: backend
  run: |
    # æ¸…ç†å¹¶é‡æ–°å®‰è£…ä¾èµ–
    rm -rf node_modules dist
    pnpm install --no-frozen-lockfile
    
    # éªŒè¯å…³é”®ä¾èµ–
    ls node_modules/typescript || echo "âŒ TypeScript ç¼ºå¤±"
    ls node_modules/depd || echo "âŒ depd ç¼ºå¤±"
    ls node_modules/express || echo "âŒ express ç¼ºå¤±"
    
    # ç›´æ¥ä½¿ç”¨TypeScriptç¼–è¯‘å™¨
    npx tsc
    
    # éªŒè¯æ„å»ºäº§ç‰©
    ls -la dist/ || echo "distç›®å½•ä¸å­˜åœ¨"
    ls -la dist/*.js || echo "ç¼–è¯‘çš„JSæ–‡ä»¶ä¸å­˜åœ¨"
```

#### ğŸ“¦ **éƒ¨ç½²äº§ç‰©éªŒè¯**
```yaml
# éªŒè¯å…³é”®æ„å»ºäº§ç‰©
echo "ğŸ” éªŒè¯åç«¯æ„å»ºäº§ç‰©..."
ls -la dist/backend/ || echo "âŒ backendæ„å»ºäº§ç‰©ä¸å­˜åœ¨"
ls -la dist/backend/index.js || echo "âŒ ä¸»å…¥å£æ–‡ä»¶ä¸å­˜åœ¨"
ls -la dist/node_modules/depd/ || echo "âŒ depdä¾èµ–ä¸å­˜åœ¨"
```

#### ğŸš€ **ç®€åŒ–çš„éƒ¨ç½²è„šæœ¬**
ç§»é™¤äº†å¤æ‚çš„è·¯å¾„åˆ«ååŒ…è£…å™¨ (`start-server.js`)ï¼Œç›´æ¥ä½¿ç”¨ç¼–è¯‘åçš„æ–‡ä»¶ï¼š
```bash
# éªŒè¯éƒ¨ç½²æ–‡ä»¶ç»“æ„
ls -la backend/index.js || echo "âŒ backend/index.jsä¸å­˜åœ¨"
ls -la node_modules/depd/ || echo "âŒ depdä¾èµ–ä¸å­˜åœ¨"

# éªŒè¯PM2é…ç½®
grep "script:" ecosystem.config.js || echo "âŒ PM2è„šæœ¬é…ç½®ä¸å­˜åœ¨"
```

## ğŸ”„ éƒ¨ç½²æµç¨‹

### è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹
1. **ä»£ç æ¨é€** â†’ `git push origin main`
2. **GitHub Actionsè§¦å‘** â†’ `.github/workflows/axi-project-dashboard_deploy.yml`
3. **æ„å»ºé˜¶æ®µ**ï¼š
   - å®‰è£…ä¾èµ–å¹¶éªŒè¯å…³é”®æ¨¡å—
   - TypeScriptç¼–è¯‘åˆ° `backend/dist/`
   - å‰ç«¯Reactæ„å»º
4. **éƒ¨ç½²å‡†å¤‡**ï¼š
   - å¤åˆ¶æ„å»ºäº§ç‰©åˆ°éƒ¨ç½²åŒ…
   - éªŒè¯æ–‡ä»¶å®Œæ•´æ€§
5. **æœåŠ¡å™¨éƒ¨ç½²**ï¼š
   - ä¸Šä¼ åˆ° `/srv/apps/axi-project-dashboard`
   - PM2å¯åŠ¨ `./backend/index.js`

### éªŒè¯éƒ¨ç½²æˆåŠŸ
```bash
# æ£€æŸ¥PM2è¿›ç¨‹
pm2 list

# æŸ¥çœ‹æ—¥å¿—
pm2 logs dashboard-backend

# å¥åº·æ£€æŸ¥
curl https://redamancy.com.cn/project-dashboard/api/health
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¦‚æœä»ç„¶é‡åˆ° `depd` æ¨¡å—é”™è¯¯ï¼š

1. **æ£€æŸ¥æ„å»ºæ—¥å¿—**ï¼š
   - åœ¨GitHub Actionsä¸­æŸ¥çœ‹"æ„å»ºåç«¯"æ­¥éª¤çš„æ—¥å¿—
   - ç¡®è®¤ `ls node_modules/depd` æ˜¾ç¤ºä¾èµ–å­˜åœ¨

2. **æ£€æŸ¥éƒ¨ç½²äº§ç‰©**ï¼š
   - åœ¨"å‡†å¤‡éƒ¨ç½²æ–‡ä»¶"æ­¥éª¤ä¸­æŸ¥çœ‹éªŒè¯ç»“æœ
   - ç¡®è®¤ `dist/node_modules/depd/` è¢«æ­£ç¡®å¤åˆ¶

3. **æ£€æŸ¥æœåŠ¡å™¨æ–‡ä»¶**ï¼š
   ```bash
   ssh deploy@server
   cd /srv/apps/axi-project-dashboard
   ls -la node_modules/depd/
   ```

4. **æ£€æŸ¥PM2é…ç½®**ï¼š
   ```bash
   cat ecosystem.config.js | grep script
   ls -la backend/index.js
   ```

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] GitHub Actionsæ„å»ºæˆåŠŸå®Œæˆ
- [ ] æ„å»ºæ—¥å¿—æ˜¾ç¤ºæ‰€æœ‰ä¾èµ–éªŒè¯é€šè¿‡
- [ ] éƒ¨ç½²è„šæœ¬æˆåŠŸä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨
- [ ] PM2è¿›ç¨‹æˆåŠŸå¯åŠ¨
- [ ] å¥åº·æ£€æŸ¥ç«¯ç‚¹å¯è®¿é—®
- [ ] åº”ç”¨æ—¥å¿—æ— é”™è¯¯ä¿¡æ¯

## ğŸ¯ å…³é”®æ”¹è¿›

1. **ç®€åŒ–æ¶æ„**ï¼šç§»é™¤å¤æ‚çš„è·¯å¾„åˆ«ååŒ…è£…å™¨ï¼Œä½¿ç”¨æ ‡å‡†çš„TypeScriptç¼–è¯‘è¾“å‡º
2. **å¢å¼ºéªŒè¯**ï¼šåœ¨æ„å»ºå’Œéƒ¨ç½²çš„æ¯ä¸ªé˜¶æ®µéƒ½éªŒè¯å…³é”®æ–‡ä»¶å’Œä¾èµ–çš„å­˜åœ¨
3. **é”™è¯¯å¤„ç†**ï¼šæ”¹è¿›äº†é”™è¯¯æ£€æµ‹å’Œè¯Šæ–­ä¿¡æ¯
4. **ç»´æŠ¤æ€§**ï¼šç®€åŒ–äº†éƒ¨ç½²æµç¨‹ï¼Œæ›´å®¹æ˜“è°ƒè¯•å’Œç»´æŠ¤

è¿™äº›ä¿®å¤ç¡®ä¿äº† `axi-project-dashboard` é¡¹ç›®é€šè¿‡ GitHub Actions èƒ½å¤Ÿæ­£ç¡®æ„å»ºå’Œéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚
