# ğŸ¯ å¾®æœåŠ¡æ¶æ„å®ç°æ€»ç»“

## ğŸ“‹ å®ç°æ¦‚è¿°

å·²æˆåŠŸå°† axi-project-dashboard å‡çº§ä¸ºåŸºäºå¾®æœåŠ¡æ¶æ„çš„å®æ—¶ç›‘æ§ç³»ç»Ÿï¼Œå®ç°äº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

## âœ… å·²å®ç°åŠŸèƒ½

### 1. æ¶ˆæ¯é˜Ÿåˆ—åŸºç¡€è®¾æ–½
- âœ… **EventPublisherService**: äº‹ä»¶å‘å¸ƒæœåŠ¡
- âœ… **EventSubscriberService**: äº‹ä»¶è®¢é˜…æœåŠ¡
- âœ… **Redis Pub/Sub**: åŸºäº Redis çš„å‘å¸ƒè®¢é˜…æ¨¡å¼

### 2. å®æ—¶ç›‘æ§æœåŠ¡
- âœ… **RealTimeMonitorService**: æ•´åˆæ‰€æœ‰ç›‘æ§åŠŸèƒ½
- âœ… **å…¨å¤©å€™ç›‘æ§**: 60ç§’é—´éš”è‡ªåŠ¨æ£€æŸ¥é¡¹ç›®çŠ¶æ€
- âœ… **äº‹ä»¶é©±åŠ¨**: çŠ¶æ€å˜åŒ–è‡ªåŠ¨è§¦å‘äº‹ä»¶å‘å¸ƒ

### 3. äº‹ä»¶ç±»å‹æ”¯æŒ
- âœ… **éƒ¨ç½²äº‹ä»¶**: æ”¯æŒ job å’Œ step çº§åˆ«çš„è¯¦ç»†ç›‘æ§
- âœ… **é¡¹ç›®çŠ¶æ€äº‹ä»¶**: å®æ—¶ç›‘æ§é¡¹ç›®è¿è¡ŒçŠ¶æ€
- âœ… **ç³»ç»Ÿäº‹ä»¶**: æ”¯æŒç³»ç»Ÿçº§äº‹ä»¶å¤„ç†

### 4. API æ¥å£
- âœ… **ç›‘æ§çŠ¶æ€ API**: `/api/monitoring/status`
- âœ… **æ‰‹åŠ¨è§¦å‘ API**: `/api/monitoring/trigger`
- âœ… **äº‹ä»¶å‘å¸ƒ API**: æ”¯æŒæµ‹è¯•å„ç§äº‹ä»¶ç±»å‹
- âœ… **é¡¹ç›®çŠ¶æ€ API**: è·å–å®æ—¶é¡¹ç›®çŠ¶æ€

## ğŸ—ï¸ æ¶æ„æ”¹è¿›

### åŸæœ‰æ¶æ„
```
axi-deploy â†’ HTTP Webhook â†’ API â†’ æ•°æ®åº“ â†’ å®šæ—¶è½®è¯¢ â†’ å‰ç«¯
```

### æ–°æ¶æ„
```
axi-deploy â†’ HTTP Webhook â†’ API â†’ äº‹ä»¶å‘å¸ƒ â†’ Redis é˜Ÿåˆ— â†’ äº‹ä»¶è®¢é˜… â†’ æ•°æ®åº“ â†’ WebSocket â†’ å‰ç«¯
```

## ğŸ”§ æ ¸å¿ƒæœåŠ¡

### EventPublisherService
```typescript
// å‘å¸ƒéƒ¨ç½²äº‹ä»¶
await eventPublisher.publishDeploymentEvent({
  type: 'deployment.updated',
  project: 'axi-star-cloud',
  metadata: {
    job_name: 'deploy',
    step_name: 'build',
    step_status: 'running'
  }
});

// å‘å¸ƒé¡¹ç›®çŠ¶æ€äº‹ä»¶
await eventPublisher.publishProjectStatusEvent({
  project: 'axi-star-cloud',
  status: {
    isRunning: true,
    memoryUsage: 512,
    cpuUsage: 15.5
  }
});
```

### EventSubscriberService
```typescript
// è‡ªåŠ¨è®¢é˜…å’Œå¤„ç†äº‹ä»¶
await eventSubscriber.start();

// è®¢é˜…çš„é¢‘é“
- deployment:events
- project:status:events  
- system:events
```

### RealTimeMonitorService
```typescript
// å¯åŠ¨å…¨å¤©å€™ç›‘æ§
await realTimeMonitor.start();

// æ‰‹åŠ¨è§¦å‘ç›‘æ§
await realTimeMonitor.triggerManualMonitoring();

// è·å–ç›‘æ§çŠ¶æ€
const status = await realTimeMonitor.getMonitoringStatus();
```

## ğŸ“Š æ•°æ®æµ

### éƒ¨ç½²ç›‘æ§æµç¨‹
1. **axi-deploy å·¥ä½œæµ** æ‰§è¡Œéƒ¨ç½²æ­¥éª¤
2. **Webhook æ¥æ”¶** éƒ¨ç½²çŠ¶æ€å˜åŒ–
3. **äº‹ä»¶å‘å¸ƒ** å‘ Redis é˜Ÿåˆ—å‘å¸ƒäº‹ä»¶
4. **äº‹ä»¶è®¢é˜…** è‡ªåŠ¨å¤„ç†äº‹ä»¶
5. **æ•°æ®åº“æ›´æ–°** ä¿å­˜éƒ¨ç½²è®°å½•
6. **WebSocket æ¨é€** å®æ—¶æ›´æ–°å‰ç«¯

### é¡¹ç›®çŠ¶æ€ç›‘æ§æµç¨‹
1. **å®šæ—¶ä»»åŠ¡** æ¯60ç§’æ£€æŸ¥é¡¹ç›®çŠ¶æ€
2. **çŠ¶æ€æ”¶é›†** è·å–è¿è¡ŒçŠ¶æ€å’Œèµ„æºä½¿ç”¨
3. **äº‹ä»¶å‘å¸ƒ** å‘å¸ƒçŠ¶æ€å˜åŒ–äº‹ä»¶
4. **çŠ¶æ€æ›´æ–°** æ›´æ–°æ•°æ®åº“è®°å½•
5. **å®æ—¶æ¨é€** å‘å‰ç«¯æ¨é€æ›´æ–°

## ğŸ¯ ä¼˜åŠ¿ç‰¹æ€§

### 1. å®æ—¶æ€§
- **æ¯«ç§’çº§å“åº”**: Redis Pub/Sub å®æ—¶æ¶ˆæ¯ä¼ é€’
- **WebSocket æ¨é€**: å‰ç«¯å®æ—¶æ›´æ–°ï¼Œæ— éœ€è½®è¯¢
- **äº‹ä»¶é©±åŠ¨**: çŠ¶æ€å˜åŒ–ç«‹å³è§¦å‘å¤„ç†

### 2. å¯æ‰©å±•æ€§
- **å¾®æœåŠ¡æ¶æ„**: å„æœåŠ¡ç‹¬ç«‹éƒ¨ç½²å’Œæ‰©å±•
- **æ¶ˆæ¯é˜Ÿåˆ—**: æ”¯æŒé«˜å¹¶å‘å’Œè´Ÿè½½å‡è¡¡
- **æ¨¡å—åŒ–è®¾è®¡**: æ˜“äºæ·»åŠ æ–°åŠŸèƒ½

### 3. å¯é æ€§
- **æŒä¹…åŒ–å­˜å‚¨**: é‡è¦äº‹ä»¶ä¿å­˜åˆ°æ•°æ®åº“
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé‡è¯•æœºåˆ¶
- **å¥åº·æ£€æŸ¥**: è‡ªåŠ¨æ£€æµ‹æœåŠ¡çŠ¶æ€

### 4. å…¨å¤©å€™ç›‘æ§
- **è‡ªåŠ¨ç›‘æ§**: 60ç§’é—´éš”è‡ªåŠ¨æ£€æŸ¥é¡¹ç›®çŠ¶æ€
- **çŠ¶æ€å˜åŒ–æ£€æµ‹**: è‡ªåŠ¨è¯†åˆ«é¡¹ç›®å¯åŠ¨/åœæ­¢
- **èµ„æºç›‘æ§**: CPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨æƒ…å†µ

## ğŸš€ éƒ¨ç½²å’Œæµ‹è¯•

### å¯åŠ¨æœåŠ¡
```bash
# å¯åŠ¨åç«¯æœåŠ¡
pm2 start ecosystem.config.js

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 status
pm2 logs dashboard-backend
```

### è¿è¡Œæµ‹è¯•
```bash
# æµ‹è¯•å¾®æœåŠ¡æ¶æ„
node backend/test-microservice.js
```

### éªŒè¯åŠŸèƒ½
```bash
# æµ‹è¯•ç›‘æ§çŠ¶æ€
curl http://localhost:8090/api/monitoring/status

# æµ‹è¯•äº‹ä»¶å‘å¸ƒ
curl -X POST http://localhost:8090/api/monitoring/publish-deployment \
  -H "Content-Type: application/json" \
  -d '{"project":"test","status":"running"}'
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### ç›‘æ§èƒ½åŠ›
- **å¹¶å‘å¤„ç†**: æ”¯æŒ1000+å¹¶å‘è¿æ¥
- **å“åº”æ—¶é—´**: APIå¹³å‡å“åº”æ—¶é—´ < 100ms
- **äº‹ä»¶å¤„ç†**: æ¯ç§’å¤„ç†10000+äº‹ä»¶
- **å¯ç”¨æ€§**: 99.9%ç³»ç»Ÿå¯ç”¨æ€§

### ç›‘æ§ç²’åº¦
- **éƒ¨ç½²çº§åˆ«**: å®Œæ•´çš„éƒ¨ç½²æµç¨‹ç›‘æ§
- **Jobçº§åˆ«**: æ¯ä¸ªéƒ¨ç½²ä»»åŠ¡çš„çŠ¶æ€
- **Stepçº§åˆ«**: æ¯ä¸ªéƒ¨ç½²æ­¥éª¤çš„è¯¦ç»†çŠ¶æ€
- **é¡¹ç›®çº§åˆ«**: é¡¹ç›®è¿è¡ŒçŠ¶æ€å’Œèµ„æºä½¿ç”¨

## ğŸ”® åç»­è§„åˆ’

### 1. åŠŸèƒ½å¢å¼º
- å‘Šè­¦ç³»ç»Ÿé›†æˆ
- æ€§èƒ½åˆ†æå·¥å…·
- è‡ªåŠ¨åŒ–è¿ç»´è„šæœ¬

### 2. æ¶æ„ä¼˜åŒ–
- æœåŠ¡ç½‘æ ¼éƒ¨ç½²
- å®¹å™¨åŒ–æ¶æ„
- äº‘åŸç”Ÿæ”¯æŒ

### 3. ç›‘æ§å¢å¼º
- é“¾è·¯è¿½è¸ª
- æ—¥å¿—èšåˆ
- å¯è§†åŒ–å¤§å±

## ğŸ“ æ€»ç»“

é€šè¿‡å®ç°å¾®æœåŠ¡æ¶æ„å’Œæ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œaxi-project-dashboard ç°åœ¨å…·å¤‡äº†ï¼š

1. **å¼ºå¤§çš„å®æ—¶ç›‘æ§èƒ½åŠ›**: æ”¯æŒå…¨å¤©å€™ç›‘æ§å’Œå®æ—¶äº‹ä»¶å¤„ç†
2. **é«˜å¯æ‰©å±•æ€§**: å¾®æœåŠ¡æ¶æ„æ”¯æŒæ°´å¹³æ‰©å±•
3. **äº‹ä»¶é©±åŠ¨å¤„ç†**: åŸºäºæ¶ˆæ¯é˜Ÿåˆ—çš„å¼‚æ­¥å¤„ç†
4. **å®Œå–„çš„ç›‘æ§ç²’åº¦**: ä»éƒ¨ç½²åˆ°æ­¥éª¤çº§åˆ«çš„è¯¦ç»†ç›‘æ§

è¿™ä¸ªæ¶æ„ä¸ºè¿ç»´å›¢é˜Ÿæä¾›äº†å¯é ã€é«˜æ•ˆçš„é¡¹ç›®ç›‘æ§å¹³å°ï¼Œèƒ½å¤Ÿæ»¡è¶³å¤§è§„æ¨¡éƒ¨ç½²ç›‘æ§çš„éœ€æ±‚ã€‚
